{"notify_list":[],"description":"The Control Plane makes scheduling decisions, monitors the cluster, and implements changes to get the cluster to a desired state. \n\n\nTo enable metrics, follow the instructions listed for each integration:\n\n- [API Server](https://docs.datadoghq.com/integrations/kube_apiserver_metrics/)\n- [Controller Manager](https://docs.datadoghq.com/integrations/kube_controller_manager/)\n- [Scheduler](https://docs.datadoghq.com/integrations/kube_scheduler/)\n- [etcd](https://docs.datadoghq.com/integrations/etcd/)\n\nClone this template dashboard to make changes and add your own graph widgets.","template_variables":[{"default":"*","prefix":"scope","name":"scope"},{"default":"*","prefix":"kubernetes_cluster","name":"cluster_name"},{"default":"0.99","prefix":"quantile","name":"quantile"}],"is_read_only":false,"id":"zts-pqz-nve","title":"Kubernetes Control Plane - Overview","url":"/dashboard/zts-pqz-nve/kubernetes-control-plane---overview","created_at":"2019-07-16T00:25:17.120279+00:00","modified_at":"2019-07-16T00:27:03.721669+00:00","widgets":[{"definition":{"autoscale":true,"title":"Healthy Nodes","title_align":"left","precision":2,"time":{},"title_size":"16","requests":[{"q":"max:kube_controller_manager.nodes.count{$scope,$cluster_name}","aggregator":"max","conditional_formats":[{"palette":"white_on_green","value":0,"comparator":">"}]}],"type":"query_value"},"layout":{"y":50,"x":107,"width":13,"height":9},"id":0},{"definition":{"autoscale":true,"title":"Unhealthy Nodes","title_align":"left","precision":2,"text_align":"center","time":{},"title_size":"16","requests":[{"q":"max:kube_controller_manager.nodes.unhealthy{$scope,$cluster_name}","aggregator":"max","conditional_formats":[{"palette":"white_on_red","value":0,"comparator":">"}]}],"type":"query_value"},"layout":{"y":62,"x":107.33333333333333,"width":13,"height":9},"id":1},{"definition":{"title_size":"16","title":"Kube Controller Queue Depth","title_align":"left","time":{},"requests":[{"q":"avg:kube_controller_manager.queue.depth{$scope,$cluster_name} by {queue}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"area"}],"type":"timeseries"},"layout":{"y":68,"x":167,"width":45,"height":15},"id":2},{"definition":{"title_size":"16","title":"HTTP client requests by (method, code)","title_align":"left","time":{},"requests":[{"q":"sum:kube_controller_manager.client.http.requests{$scope,$cluster_name} by {method,code}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries"},"layout":{"y":50,"x":121,"width":45,"height":15},"id":3},{"definition":{"title_size":"16","title":"Retries Per Queue","title_align":"left","time":{},"requests":[{"q":"avg:kube_controller_manager.queue.retries{$scope,$cluster_name} by {queue}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries"},"layout":{"y":50,"x":167,"width":45,"height":15},"id":4},{"definition":{"title_size":"16","title":"Processing latency per Queue ($quantile)","title_align":"left","time":{},"requests":[{"q":"top(avg:kube_controller_manager.queue.latency.quantile{$scope,$cluster_name,$quantile} by {queue}, 10, 'mean', 'desc')","style":{"palette":"dog_classic"}}],"type":"toplist"},"layout":{"y":68,"x":121,"width":45,"height":15},"id":5},{"definition":{"autoscale":true,"title":"Go Routines","title_align":"left","precision":0,"time":{},"title_size":"16","requests":[{"q":"max:kube_controller_manager.goroutines{$scope,$cluster_name}","aggregator":"last"}],"type":"query_value"},"layout":{"y":74,"x":107.33333333333333,"width":13,"height":9},"id":6},{"definition":{"title_size":"16","title":"HTTP client requests by (method,code)","title_align":"left","time":{},"requests":[{"q":"avg:kube_scheduler.client.http.requests{$scope,$cluster_name} by {method,code}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars","metadata":[{"alias_name":"sum","expression":"avg:kube_scheduler.client.http.requests{$scope,$kubernetes_cluster} by {method,code}.as_count()"}]}],"type":"timeseries"},"layout":{"y":8,"x":121,"width":45,"height":33},"id":7},{"definition":{"title_size":"16","title":"Average HTTP client requests duration by (verb,url)","title_align":"left","time":{},"requests":[{"q":"derivative(avg:kube_scheduler.client.http.requests_duration.sum{$scope,$cluster_name} by {verb,url})/derivative(avg:kube_scheduler.client.http.requests_duration.count{$cluster_name,$scope} by {verb,url})","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"area","metadata":[{"alias_name":"duration","expression":"derivative(avg:kube_scheduler.client.http.requests_duration.sum{$scope} by {verb,url})/derivative(avg:kube_scheduler.client.http.requests_duration.count{$kubernetes_cluster} by {verb,url})"}]}],"type":"timeseries"},"layout":{"y":8,"x":167,"width":45,"height":33},"id":8},{"definition":{"autoscale":true,"title":"Go Threads","title_align":"left","precision":0,"time":{},"title_size":"16","requests":[{"q":"max:kube_scheduler.threads{$scope,$cluster_name}","aggregator":"last"}],"type":"query_value"},"layout":{"y":20,"x":107,"width":13,"height":9},"id":9},{"definition":{"autoscale":true,"title":"Go Routines","title_align":"left","precision":0,"time":{},"title_size":"16","requests":[{"q":"max:kube_scheduler.goroutines{$scope,$cluster_name}","aggregator":"last"}],"type":"query_value"},"layout":{"y":8,"x":107,"width":13,"height":9},"id":10},{"definition":{"title_size":"16","title":"Total Server Requests vs Dropped Request Count","title_align":"left","time":{},"requests":[{"q":"sum:kube_apiserver.apiserver_request_count{$scope,$cluster_name}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"area"},{"q":"sum:kube_apiserver.apiserver_dropped_requests{$scope,$cluster_name}.as_count()","style":{"line_width":"normal","palette":"warm","line_type":"solid"},"display_type":"area"}],"type":"timeseries"},"layout":{"y":50,"x":62,"width":44,"height":15},"id":11},{"definition":{"title_size":"16","title":"GRPC Server Sent and Received","title_align":"left","show_legend":false,"time":{},"requests":[{"q":"sum:etcd.network.client.grpc.sent.bytes.total{$scope,$cluster_name}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"sum:etcd.etcd_network_client_grpc_received_bytes_total{$scope,$cluster_name}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0"},"layout":{"y":8,"x":55,"width":51,"height":15},"id":12},{"definition":{"autoscale":true,"title":"Server Handle %","title_align":"left","custom_unit":"%","precision":0,"time":{},"title_size":"16","requests":[{"q":"(100*(sum:etcd.grpc.server.handled.total{$scope,$cluster_name}.as_count()/sum:etcd.grpc.server.started.total{$scope,$cluster_name}.as_count()))","aggregator":"avg","conditional_formats":[{"palette":"white_on_green","value":99,"comparator":">"}]}],"type":"query_value"},"layout":{"y":32,"x":42,"width":12,"height":9},"id":13},{"definition":{"autoscale":true,"title":"Failed Server Proposals","title_align":"left","precision":2,"time":{},"title_size":"16","requests":[{"q":"sum:etcd.server.proposals.failed.total{$scope,$cluster_name}.as_count()","aggregator":"sum","conditional_formats":[{"palette":"white_on_red","value":0,"comparator":">"}]}],"type":"query_value"},"layout":{"y":20,"x":29,"width":12,"height":9},"id":14},{"definition":{"autoscale":false,"title":"Leader Changes","title_align":"left","precision":0,"time":{},"title_size":"16","requests":[{"q":"sum:etcd.server.leader.changes.seen.total{$scope,$cluster_name}.as_count()","aggregator":"max","conditional_formats":[]}],"type":"query_value"},"layout":{"y":8,"x":42,"width":12,"height":9},"id":15},{"definition":{"autoscale":true,"title":"Pending Server Proposals","title_align":"left","precision":0,"time":{},"title_size":"16","requests":[{"q":"sum:etcd.server.proposals.pending{$scope,$cluster_name} by {service}","aggregator":"sum","conditional_formats":[]}],"type":"query_value"},"layout":{"y":20,"x":42,"width":12,"height":9},"id":16},{"definition":{"title_size":"16","title":"Go GC Duration","title_align":"left","show_legend":false,"time":{},"requests":[{"q":"avg:etcd.go.gc.duration.seconds.quantile{$scope,$cluster_name}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0"},"layout":{"y":26,"x":55,"width":51,"height":15},"id":17},{"definition":{"title_size":"16","title":"Objects Seen","title_align":"left","time":{},"requests":[{"q":"top(max:kube_apiserver.etcd_object_counts{$cluster_name,$scope} by {resource}, 50, 'mean', 'desc')","style":{"palette":"dog_classic"}}],"type":"toplist"},"layout":{"y":68,"x":15,"width":46,"height":15},"id":18},{"definition":{"autoscale":true,"title":"HTTP Requests","title_align":"left","precision":2,"time":{},"title_size":"16","requests":[{"q":"sum:kube_scheduler.client.http.requests{$scope,$cluster_name}.as_count()","aggregator":"last"}],"type":"query_value"},"layout":{"y":32,"x":107,"width":13,"height":9},"id":19},{"definition":{"autoscale":true,"title":"Go Threads","title_align":"left","precision":2,"time":{},"title_size":"16","requests":[{"q":"max:kube_apiserver.go_threads{$scope,$cluster_name}","aggregator":"max"}],"type":"query_value"},"layout":{"y":32,"x":29,"width":12,"height":9},"id":20},{"definition":{"autoscale":true,"title":"Go Routines","title_align":"left","precision":2,"time":{},"title_size":"16","requests":[{"q":"max:kube_apiserver.go_goroutines{$scope,$cluster_name}","aggregator":"max"}],"type":"query_value"},"layout":{"y":62,"x":1,"width":13,"height":9},"id":21},{"definition":{"autoscale":true,"title":"Client Requests","title_align":"left","precision":2,"time":{},"title_size":"16","requests":[{"q":"max:kube_apiserver.rest_client_requests_total{$scope,$cluster_name}.as_count()","aggregator":"max"}],"type":"query_value"},"layout":{"y":74,"x":1,"width":13,"height":9},"id":22},{"definition":{"title_size":"16","title":"Service Registration Queue Depth","title_align":"left","time":{},"requests":[{"q":"sum:kube_apiserver.APIServiceRegistrationController_depth{$cluster_name,$scope}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries"},"layout":{"y":50,"x":15,"width":46,"height":15},"id":23},{"definition":{"autoscale":true,"title":"etcd has leader","title_align":"left","precision":0,"time":{},"title_size":"16","requests":[{"q":"avg:etcd.server.has_leader{$scope,$cluster_name}","aggregator":"max","conditional_formats":[{"palette":"white_on_red","value":1,"comparator":"<"},{"palette":"white_on_green","value":1,"comparator":">="}]}],"type":"query_value"},"layout":{"y":8,"x":29,"width":12,"height":9},"id":24},{"definition":{"title_size":"16","title":"HTTP client requests by (method,code)","title_align":"left","time":{},"requests":[{"q":"sum:kube_apiserver.http_requests_total{$scope,$cluster_name} by {method,code}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries"},"layout":{"y":68,"x":62,"width":44,"height":15},"id":25},{"definition":{"autoscale":true,"title":"Go Threads","title_align":"left","precision":2,"time":{},"title_size":"16","requests":[{"q":"max:kube_apiserver.go_threads{$cluster_name,$scope}","aggregator":"max"}],"type":"query_value"},"layout":{"y":50,"x":1,"width":13,"height":9},"id":26},{"definition":{"url":"https://trello-attachments.s3.amazonaws.com/5c747d70330c3550f87cd622/5cda0de7164caf43ababc48e/30833f2fe247fd8d71efd4cde7f8a6ff/kubernetes_control_plane_final-01.png","sizing":"fit","type":"image"},"layout":{"y":22,"x":1,"width":27,"height":21},"id":27},{"definition":{"url":"/static/images/screenboard/integrations/kubernetes.jpg","sizing":"fit","type":"image"},"layout":{"y":2,"x":1,"width":27,"height":20},"id":28},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"bottom","text_align":"center","content":"API Server","font_size":"24","background_color":"gray"},"layout":{"y":44,"x":1,"width":27,"height":5},"id":29},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"bottom","text_align":"center","content":"Controller Manager","font_size":"18","background_color":"gray"},"layout":{"y":44,"x":107,"width":27,"height":5},"id":30},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"bottom","text_align":"center","content":"ETCD","font_size":"18","background_color":"gray"},"layout":{"y":2,"x":29,"width":25,"height":5},"id":31},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"bottom","text_align":"center","content":"Scheduler","font_size":"18","background_color":"gray"},"layout":{"y":2,"x":107,"width":27,"height":5},"id":32},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"left","text_align":"left","content":"Runs control loops to monitor the current state of the cluster and takes action to move it towards the desired state.","font_size":"14","background_color":"yellow"},"layout":{"y":44,"x":136,"width":76,"height":5},"id":33},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"left","text_align":"left","content":"The communication hub of the Kubernetes cluster, listening and dispatching requests from the other components of the plane.","font_size":"14","background_color":"yellow"},"layout":{"y":44,"x":30,"width":76,"height":5},"id":34},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"left","text_align":"left","content":"The key-value store for coordination and the state management of the cluster.","font_size":"14","background_color":"yellow"},"layout":{"y":2,"x":56,"width":50,"height":5},"id":35},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"left","text_align":"left","content":"Schedules the deployment of pods by scouting for unscheduled pods and spreading them across available clusters.","font_size":"14","background_color":"yellow"},"layout":{"y":2,"x":136,"width":76,"height":5},"id":36}],"layout_type":"free"}