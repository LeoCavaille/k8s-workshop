{"title":"Kubernetes Control Plane - Overview","description":"The Control Plane makes scheduling decisions, monitors the cluster, and implements changes to get the cluster to a desired state. \n\n\nTo enable metrics, follow the instructions listed for each integration:\n\n- [API Server](https://docs.datadoghq.com/integrations/kube_apiserver_metrics/)\n- [Controller Manager](https://docs.datadoghq.com/integrations/kube_controller_manager/)\n- [Scheduler](https://docs.datadoghq.com/integrations/kube_scheduler/)\n- [etcd](https://docs.datadoghq.com/integrations/etcd/)\n\nClone this template dashboard to make changes and add your own graph widgets.","widgets":[{"id":0,"definition":{"type":"query_value","requests":[{"q":"max:kube_controller_manager.nodes.count{$scope,$cluster_name}","aggregator":"max","conditional_formats":[{"comparator":">","value":0,"palette":"white_on_green"}]}],"title":"Healthy Nodes","title_size":"16","title_align":"left","autoscale":true,"precision":2},"layout":{"x":107,"y":50,"width":13,"height":9}},{"id":1,"definition":{"type":"query_value","requests":[{"q":"max:kube_controller_manager.nodes.unhealthy{$scope,$cluster_name}","aggregator":"max","conditional_formats":[{"comparator":">","value":0,"palette":"white_on_red"}]}],"title":"Unhealthy Nodes","title_size":"16","title_align":"left","autoscale":true,"precision":2,"text_align":"center"},"layout":{"x":107.33333333333333,"y":62,"width":13,"height":9}},{"id":2,"definition":{"type":"timeseries","requests":[{"q":"avg:kube_controller_manager.queue.depth{$scope,$cluster_name} by {queue}","display_type":"area","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Kube Controller Queue Depth","title_size":"16","title_align":"left"},"layout":{"x":167,"y":68,"width":45,"height":15}},{"id":3,"definition":{"type":"timeseries","requests":[{"q":"sum:kube_controller_manager.client.http.requests{$scope,$cluster_name} by {method,code}.as_count()","display_type":"bars","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"HTTP client requests by (method, code)","title_size":"16","title_align":"left"},"layout":{"x":121,"y":50,"width":45,"height":15}},{"id":4,"definition":{"type":"timeseries","requests":[{"q":"avg:kube_controller_manager.queue.retries{$scope,$cluster_name} by {queue}.as_count()","display_type":"bars","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Retries Per Queue","title_size":"16","title_align":"left"},"layout":{"x":167,"y":50,"width":45,"height":15}},{"id":5,"definition":{"type":"toplist","requests":[{"q":"top(avg:kube_controller_manager.queue.latency.quantile{$scope,$cluster_name,$quantile} by {queue}, 10, 'mean', 'desc')","style":{"palette":"dog_classic"}}],"title":"Processing latency per Queue ($quantile)","title_size":"16","title_align":"left"},"layout":{"x":121,"y":68,"width":45,"height":15}},{"id":6,"definition":{"type":"query_value","requests":[{"q":"max:kube_controller_manager.goroutines{$scope,$cluster_name}","aggregator":"last"}],"title":"Go Routines","title_size":"16","title_align":"left","autoscale":true,"precision":0},"layout":{"x":107.33333333333333,"y":74,"width":13,"height":9}},{"id":7,"definition":{"type":"timeseries","requests":[{"q":"avg:kube_scheduler.client.http.requests{$scope,$cluster_name} by {method,code}.as_count()","metadata":[{"expression":"avg:kube_scheduler.client.http.requests{$scope,$kubernetes_cluster} by {method,code}.as_count()","alias_name":"sum"}],"display_type":"bars","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"HTTP client requests by (method,code)","title_size":"16","title_align":"left"},"layout":{"x":121,"y":8,"width":45,"height":33}},{"id":8,"definition":{"type":"timeseries","requests":[{"q":"derivative(avg:kube_scheduler.client.http.requests_duration.sum{$scope,$cluster_name} by {verb,url})/derivative(avg:kube_scheduler.client.http.requests_duration.count{$cluster_name,$scope} by {verb,url})","metadata":[{"expression":"derivative(avg:kube_scheduler.client.http.requests_duration.sum{$scope} by {verb,url})/derivative(avg:kube_scheduler.client.http.requests_duration.count{$kubernetes_cluster} by {verb,url})","alias_name":"duration"}],"display_type":"area","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Average HTTP client requests duration by (verb,url)","title_size":"16","title_align":"left"},"layout":{"x":167,"y":8,"width":45,"height":33}},{"id":9,"definition":{"type":"query_value","requests":[{"q":"max:kube_scheduler.threads{$scope,$cluster_name}","aggregator":"last"}],"title":"Go Threads","title_size":"16","title_align":"left","autoscale":true,"precision":0},"layout":{"x":107,"y":20,"width":13,"height":9}},{"id":10,"definition":{"type":"query_value","requests":[{"q":"max:kube_scheduler.goroutines{$scope,$cluster_name}","aggregator":"last"}],"title":"Go Routines","title_size":"16","title_align":"left","autoscale":true,"precision":0},"layout":{"x":107,"y":8,"width":13,"height":9}},{"id":11,"definition":{"type":"timeseries","requests":[{"q":"sum:kube_apiserver.apiserver_request_count{$scope,$cluster_name}.as_count()","display_type":"area","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}},{"q":"sum:kube_apiserver.apiserver_dropped_requests{$scope,$cluster_name}.as_count()","display_type":"area","style":{"palette":"warm","line_type":"solid","line_width":"normal"}}],"title":"Total Server Requests vs Dropped Request Count","title_size":"16","title_align":"left"},"layout":{"x":62,"y":50,"width":44,"height":15}},{"id":12,"definition":{"type":"timeseries","requests":[{"q":"sum:etcd.etcd_network_client_grpc_sent_bytes_total{$scope,$cluster_name}.as_count()","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}},{"q":"sum:etcd.etcd_network_client_grpc_received_bytes_total{$scope,$cluster_name}.as_count()","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"GRPC Server Sent and Received","title_size":"16","title_align":"left"},"layout":{"x":55,"y":8,"width":51,"height":15}},{"id":13,"definition":{"type":"query_value","requests":[{"q":"(100*(sum:etcd.grpc_server_handled_total{$scope,$cluster_name}.as_count()/sum:etcd.grpc_server_started_total{$scope,$cluster_name}.as_count()))","aggregator":"avg","conditional_formats":[{"comparator":">","value":99,"palette":"white_on_green"}]}],"title":"Server Handle %","title_size":"16","title_align":"left","autoscale":true,"custom_unit":"%","precision":0},"layout":{"x":42,"y":32,"width":12,"height":9}},{"id":14,"definition":{"type":"query_value","requests":[{"q":"sum:etcd.etcd_server_proposals_failed_total{$scope,$cluster_name}.as_count()","aggregator":"sum","conditional_formats":[{"comparator":">","value":0,"palette":"white_on_red"}]}],"title":"Failed Server Proposals","title_size":"16","title_align":"left","autoscale":true,"precision":2},"layout":{"x":29,"y":20,"width":12,"height":9}},{"id":15,"definition":{"type":"query_value","requests":[{"q":"sum:etcd.etcd_server_leader_changes_seen_total{$scope,$cluster_name}.as_count()","aggregator":"max"}],"title":"Leader Changes","title_size":"16","title_align":"left","autoscale":false,"precision":0},"layout":{"x":42,"y":8,"width":12,"height":9}},{"id":16,"definition":{"type":"query_value","requests":[{"q":"sum:etcd.etcd_server_proposals_pending{$scope,$cluster_name} by {service}","aggregator":"sum"}],"title":"Pending Server Proposals","title_size":"16","title_align":"left","autoscale":true,"precision":0},"layout":{"x":42,"y":20,"width":12,"height":9}},{"id":17,"definition":{"type":"timeseries","requests":[{"q":"avg:etcd.go_gc_duration_seconds.quantile{$scope,$cluster_name}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Go GC Duration","title_size":"16","title_align":"left"},"layout":{"x":55,"y":26,"width":51,"height":15}},{"id":18,"definition":{"type":"toplist","requests":[{"q":"top(max:kube_apiserver.etcd_object_counts{$cluster_name,$scope} by {resource}, 50, 'mean', 'desc')","style":{"palette":"dog_classic"}}],"title":"Objects Seen","title_size":"16","title_align":"left"},"layout":{"x":15,"y":68,"width":46,"height":15}},{"id":19,"definition":{"type":"query_value","requests":[{"q":"sum:kube_scheduler.client.http.requests{$scope,$cluster_name}.as_count()","aggregator":"last"}],"title":"HTTP Requests","title_size":"16","title_align":"left","autoscale":true,"precision":2},"layout":{"x":107,"y":32,"width":13,"height":9}},{"id":20,"definition":{"type":"query_value","requests":[{"q":"max:kube_apiserver.go_threads{$scope,$cluster_name}","aggregator":"max"}],"title":"Go Threads","title_size":"16","title_align":"left","autoscale":true,"precision":2},"layout":{"x":29,"y":32,"width":12,"height":9}},{"id":21,"definition":{"type":"query_value","requests":[{"q":"max:kube_apiserver.go_goroutines{$scope,$cluster_name}","aggregator":"max"}],"title":"Go Routines","title_size":"16","title_align":"left","autoscale":true,"precision":2},"layout":{"x":1,"y":62,"width":13,"height":9}},{"id":22,"definition":{"type":"query_value","requests":[{"q":"max:kube_apiserver.rest_client_requests_total{$scope,$cluster_name}.as_count()","aggregator":"max"}],"title":"Client Requests","title_size":"16","title_align":"left","autoscale":true,"precision":2},"layout":{"x":1,"y":74,"width":13,"height":9}},{"id":23,"definition":{"type":"timeseries","requests":[{"q":"sum:kube_apiserver.APIServiceRegistrationController_depth{$cluster_name,$scope}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Service Registration Queue Depth","title_size":"16","title_align":"left"},"layout":{"x":15,"y":50,"width":46,"height":15}},{"id":24,"definition":{"type":"query_value","requests":[{"q":"avg:etcd.etcd_server_has_leader{$scope,$cluster_name}","aggregator":"max","conditional_formats":[{"comparator":"<","value":1,"palette":"white_on_red"},{"comparator":">=","value":1,"palette":"white_on_green"}]}],"title":"etcd has leader","title_size":"16","title_align":"left","autoscale":true,"precision":0},"layout":{"x":29,"y":8,"width":12,"height":9}},{"id":25,"definition":{"type":"timeseries","requests":[{"q":"sum:kube_apiserver.http_requests_total{$scope,$cluster_name} by {method,code}.as_count()","display_type":"bars","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"HTTP client requests by (method,code)","title_size":"16","title_align":"left"},"layout":{"x":62,"y":68,"width":44,"height":15}},{"id":26,"definition":{"type":"query_value","requests":[{"q":"max:kube_apiserver.go_threads{$cluster_name,$scope}","aggregator":"max"}],"title":"Go Threads","title_size":"16","title_align":"left","autoscale":true,"precision":2},"layout":{"x":1,"y":50,"width":13,"height":9}},{"id":27,"definition":{"type":"image","url":"https://trello-attachments.s3.amazonaws.com/5c747d70330c3550f87cd622/5cda0de7164caf43ababc48e/30833f2fe247fd8d71efd4cde7f8a6ff/kubernetes_control_plane_final-01.png","sizing":"fit"},"layout":{"x":1,"y":22,"width":27,"height":21}},{"id":28,"definition":{"type":"image","url":"/static/images/screenboard/integrations/kubernetes.jpg","sizing":"fit"},"layout":{"x":1,"y":2,"width":27,"height":20}},{"id":29,"definition":{"type":"note","content":"API Server","background_color":"gray","font_size":"24","text_align":"center","tick_pos":"50%","tick_edge":"bottom"},"layout":{"x":1,"y":44,"width":27,"height":5}},{"id":30,"definition":{"type":"note","content":"Controller Manager","background_color":"gray","font_size":"18","text_align":"center","tick_pos":"50%","tick_edge":"bottom"},"layout":{"x":107,"y":44,"width":27,"height":5}},{"id":31,"definition":{"type":"note","content":"ETCD","background_color":"gray","font_size":"18","text_align":"center","tick_pos":"50%","tick_edge":"bottom"},"layout":{"x":29,"y":2,"width":25,"height":5}},{"id":32,"definition":{"type":"note","content":"Scheduler","background_color":"gray","font_size":"18","text_align":"center","tick_pos":"50%","tick_edge":"bottom"},"layout":{"x":107,"y":2,"width":27,"height":5}},{"id":33,"definition":{"type":"note","content":"Runs control loops to monitor the current state of the cluster and takes action to move it towards the desired state.","background_color":"yellow","font_size":"14","text_align":"left","tick_pos":"50%","tick_edge":"left"},"layout":{"x":136,"y":44,"width":76,"height":5}},{"id":34,"definition":{"type":"note","content":"The communication hub of the Kubernetes cluster, listening and dispatching requests from the other components of the plane.","background_color":"yellow","font_size":"14","text_align":"left","tick_pos":"50%","tick_edge":"left"},"layout":{"x":30,"y":44,"width":76,"height":5}},{"id":35,"definition":{"type":"note","content":"The key-value store for coordination and the state management of the cluster.","background_color":"yellow","font_size":"14","text_align":"left","tick_pos":"50%","tick_edge":"left"},"layout":{"x":56,"y":2,"width":50,"height":5}},{"id":36,"definition":{"type":"note","content":"Schedules the deployment of pods by scouting for unscheduled pods and spreading them across available clusters.","background_color":"yellow","font_size":"14","text_align":"left","tick_pos":"50%","tick_edge":"left"},"layout":{"x":136,"y":2,"width":76,"height":5}}],"template_variables":[{"name":"scope","default":"*","prefix":"scope"},{"name":"cluster_name","default":"*","prefix":"kubernetes_cluster"},{"name":"quantile","default":"0.99","prefix":"quantile"}],"layout_type":"free","is_read_only":false,"notify_list":[]}
